
> bebang-backend@1.0.0 test
> jest src/modules/auth/__tests__/integration/auth.api.test.ts

  console.log
    Running test migrations...

      at Object.<anonymous> (src/test/setup.ts:11:21)

  console.info
    { event: 'migrating', name: '19_create_employee_documents.ts' }

      at Umzug.logging (node_modules/umzug/src/umzug.ts:99:26)

  console.error
    Unable to connect to the database or run migrations: MigrationError: Migration 19_create_employee_documents.ts (up) failed: Original error: (intermediate value).up is not a function
        at C:\project-it\bis-fix\backend\node_modules\umzug\src\umzug.ts:261:17
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Umzug.runCommand (C:\project-it\bis-fix\backend\node_modules\umzug\src\umzug.ts:210:14)
        at Object.<anonymous> (C:\project-it\bis-fix\backend\src\test\setup.ts:12:13) {
      cause: TypeError: (intermediate value).up is not a function
          at Object.up (C:\project-it\bis-fix\backend\node_modules\umzug\src\umzug.ts:147:52)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at C:\project-it\bis-fix\backend\node_modules\umzug\src\umzug.ts:259:11
          at Umzug.runCommand (C:\project-it\bis-fix\backend\node_modules\umzug\src\umzug.ts:210:14)
          at Object.<anonymous> (C:\project-it\bis-fix\backend\src\test\setup.ts:12:13),
      jse_cause: TypeError: (intermediate value).up is not a function
          at Object.up (C:\project-it\bis-fix\backend\node_modules\umzug\src\umzug.ts:147:52)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at C:\project-it\bis-fix\backend\node_modules\umzug\src\umzug.ts:259:11
          at Umzug.runCommand (C:\project-it\bis-fix\backend\node_modules\umzug\src\umzug.ts:210:14)
          at Object.<anonymous> (C:\project-it\bis-fix\backend\src\test\setup.ts:12:13),
      migration: {
        direction: 'up',
        name: '19_create_employee_documents.ts',
        path: 'C:\\project-it\\bis-fix\\backend\\src\\database\\migrations\\19_create_employee_documents.ts',
        context: PostgresQueryInterface {
          sequelize: [Sequelize],
          queryGenerator: [PostgresQueryGenerator]
        }
      }
    }

    [0m [90m 14 |[39m         }
     [90m 15 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 16 |[39m         console[33m.[39merror([32m'Unable to connect to the database or run migrations:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 17 |[39m     }
     [90m 18 |[39m })[33m;[39m
     [90m 19 |[39m[0m

      at Object.<anonymous> (src/test/setup.ts:16:17)

FAIL src/modules/auth/__tests__/integration/auth.api.test.ts (11.007 s)
  Auth API Integration
    POST /api/auth/login
      â”œÃ¹ should login successfully with valid credentials (1 ms)
      â”œÃ¹ should reject login with invalid password (1 ms)
      â”œÃ¹ should reject login with non-existent user
      â”œÃ¹ should reject invalid input format

  Î“Ã¹Ã… Auth API Integration Î“Ã‡â•‘ POST /api/auth/login Î“Ã‡â•‘ should login successfully with valid credentials



      18 |         // Seed Test User
      19 |         const hashedPassword = await bcrypt.hash(testPassword, 10);
    > 20 |         testUser = await User.create({
         |                    ^
      21 |             nama: 'Test User Integration',
      22 |             nik: '999999',
      23 |             password: hashedPassword,

      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)
      at node_modules/sequelize/src/sequelize.js:650:28
      at PostgresQueryInterface.insert (node_modules/sequelize/src/dialects/abstract/query-interface.js:795:21)
      at User.save (node_modules/sequelize/src/model.js:4154:35)
      at Function.create (node_modules/sequelize/src/model.js:2305:12)
      at Object.<anonymous> (src/modules/auth/__tests__/integration/auth.api.test.ts:20:20)

  Î“Ã¹Ã… Auth API Integration Î“Ã‡â•‘ POST /api/auth/login Î“Ã‡â•‘ should reject login with invalid password



      18 |         // Seed Test User
      19 |         const hashedPassword = await bcrypt.hash(testPassword, 10);
    > 20 |         testUser = await User.create({
         |                    ^
      21 |             nama: 'Test User Integration',
      22 |             nik: '999999',
      23 |             password: hashedPassword,

      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)
      at node_modules/sequelize/src/sequelize.js:650:28
      at PostgresQueryInterface.insert (node_modules/sequelize/src/dialects/abstract/query-interface.js:795:21)
      at User.save (node_modules/sequelize/src/model.js:4154:35)
      at Function.create (node_modules/sequelize/src/model.js:2305:12)
      at Object.<anonymous> (src/modules/auth/__tests__/integration/auth.api.test.ts:20:20)

  Î“Ã¹Ã… Auth API Integration Î“Ã‡â•‘ POST /api/auth/login Î“Ã‡â•‘ should reject login with non-existent user



      18 |         // Seed Test User
      19 |         const hashedPassword = await bcrypt.hash(testPassword, 10);
    > 20 |         testUser = await User.create({
         |                    ^
      21 |             nama: 'Test User Integration',
      22 |             nik: '999999',
      23 |             password: hashedPassword,

      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)
      at node_modules/sequelize/src/sequelize.js:650:28
      at PostgresQueryInterface.insert (node_modules/sequelize/src/dialects/abstract/query-interface.js:795:21)
      at User.save (node_modules/sequelize/src/model.js:4154:35)
      at Function.create (node_modules/sequelize/src/model.js:2305:12)
      at Object.<anonymous> (src/modules/auth/__tests__/integration/auth.api.test.ts:20:20)

  Î“Ã¹Ã… Auth API Integration Î“Ã‡â•‘ POST /api/auth/login Î“Ã‡â•‘ should reject invalid input format



      18 |         // Seed Test User
      19 |         const hashedPassword = await bcrypt.hash(testPassword, 10);
    > 20 |         testUser = await User.create({
         |                    ^
      21 |             nama: 'Test User Integration',
      22 |             nik: '999999',
      23 |             password: hashedPassword,

      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)
      at node_modules/sequelize/src/sequelize.js:650:28
      at PostgresQueryInterface.insert (node_modules/sequelize/src/dialects/abstract/query-interface.js:795:21)
      at User.save (node_modules/sequelize/src/model.js:4154:35)
      at Function.create (node_modules/sequelize/src/model.js:2305:12)
      at Object.<anonymous> (src/modules/auth/__tests__/integration/auth.api.test.ts:20:20)

Test Suites: 1 failed, 1 total
Tests:       4 failed, 4 total
Snapshots:   0 total
Time:        11.414 s
Ran all test suites matching /src\\modules\\auth\\__tests__\\integration\\auth.api.test.ts/i.
