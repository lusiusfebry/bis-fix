  console.log
    Executed (default): SELECT 1+1 AS result Elapsed time: 1ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Running test migrations...

      at Object.<anonymous> (src/test/setup.ts:11:21)

  console.log
    Executed (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'SequelizeMeta' Elapsed time: 8ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)
          at async Promise.all (index 1)

  console.log
    Executed (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'SequelizeMeta' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname; Elapsed time: 7ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)
          at async Promise.all (index 1)

  console.log
    Executed (default): SELECT "name" FROM "SequelizeMeta" AS "SequelizeMeta" ORDER BY "SequelizeMeta"."name" ASC; Elapsed time: 1ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)
          at async Promise.all (index 1)

  console.log
    Found 0 pending migrations.

      at Object.<anonymous> (src/test/setup.ts:13:21)

  console.log
    Executed (default): SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'SequelizeMeta' Elapsed time: 1ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)
          at async Promise.all (index 1)

  console.log
    Executed (default): SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'SequelizeMeta' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname; Elapsed time: 2ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)
          at async Promise.all (index 1)

  console.log
    Executed (default): SELECT "name" FROM "SequelizeMeta" AS "SequelizeMeta" ORDER BY "SequelizeMeta"."name" ASC; Elapsed time: 1ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)
          at async Promise.all (index 1)

  console.log
    Test migrations completed.

      at Object.<anonymous> (src/test/setup.ts:18:21)

  console.log
    Executed (default): SELECT 1+1 AS result Elapsed time: 1ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executed (default): DELETE FROM "users" WHERE "nik" = '999999' Elapsed time: 2ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executed (default): INSERT INTO "users" ("id","nama","nik","password","role_id","is_active","created_at","updated_at") VALUES (DEFAULT,$1,$2,$3,$4,$5,$6,$7) RETURNING "id","nama","nik","password","employee_id","role_id","is_active","last_login","created_at","updated_at"; Elapsed time: 4ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Test user created: 3

      at Object.<anonymous> (src/modules/auth/__tests__/integration/auth.api.test.ts:27:21)

  console.log
    Executed (default): SELECT "User"."id", "User"."nama", "User"."nik", "User"."password", "User"."employee_id", "User"."role_id", "User"."is_active", "User"."last_login", "User"."created_at", "User"."updated_at", "employee"."id" AS "employee.id", "employee"."foto_karyawan" AS "employee.foto_karyawan", "employee"."nama_lengkap" AS "employee.nama_lengkap", "employee"."nomor_induk_karyawan" AS "employee.nomor_induk_karyawan", "employee"."divisi_id" AS "employee.divisi_id", "employee"."department_id" AS "employee.department_id", "employee"."manager_id" AS "employee.manager_id", "employee"."atasan_langsung_id" AS "employee.atasan_langsung_id", "employee"."posisi_jabatan_id" AS "employee.posisi_jabatan_id", "employee"."email_perusahaan" AS "employee.email_perusahaan", "employee"."nomor_handphone" AS "employee.nomor_handphone", "employee"."status_karyawan_id" AS "employee.status_karyawan_id", "employee"."lokasi_kerja_id" AS "employee.lokasi_kerja_id", "employee"."tag_id" AS "employee.tag_id", "employee"."createdAt" AS "employee.createdAt", "employee"."updatedAt" AS "employee.updatedAt", "roleDetails"."id" AS "roleDetails.id", "roleDetails"."name" AS "roleDetails.name", "roleDetails"."display_name" AS "roleDetails.display_name", "roleDetails"."description" AS "roleDetails.description", "roleDetails"."is_system_role" AS "roleDetails.is_system_role", "roleDetails"."created_at" AS "roleDetails.created_at", "roleDetails"."updated_at" AS "roleDetails.updated_at" FROM "users" AS "User" LEFT OUTER JOIN "employees" AS "employee" ON "User"."employee_id" = "employee"."id" LEFT OUTER JOIN "roles" AS "roleDetails" ON "User"."role_id" = "roleDetails"."id" WHERE "User"."nik" = '999999'; Elapsed time: 10ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executed (default): UPDATE "users" SET "last_login"=$1,"updated_at"=$2 WHERE "id" = $3 Elapsed time: 1ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.error
    Error: Association with alias "permissions" does not exist on Role
        at Function._transformStringAssociation (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:358:15)
        at Function._conformInclude (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:371:22)
        at C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:352:59
        at Array.map (<anonymous>)
        at Function._conformIncludes (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:352:39)
        at Function._conformInclude (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:405:16)
        at C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:352:59
        at Array.map (<anonymous>)
        at Function._conformIncludes (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:352:39)
        at Function._baseMerge (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:818:10)
        at Function._defaultsOptions (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:861:17)
        at Function._injectScope (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:3413:10)
        at Function.findAll (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:1777:10)
        at Function.findOne (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:1998:23)
        at Function.findByPk (C:\project-it\bis-fix\backend\node_modules\sequelize\src\model.js:1955:23)
        at AuthController.login (C:\project-it\bis-fix\backend\src\modules\auth\controllers\auth.controller.ts:18:41)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

    [0m [90m 43 |[39m [90m// Error handling middleware[39m
     [90m 44 |[39m app[33m.[39muse((err[33m:[39m any[33m,[39m req[33m:[39m express[33m.[39m[33mRequest[39m[33m,[39m res[33m:[39m express[33m.[39m[33mResponse[39m[33m,[39m _next[33m:[39m express[33m.[39m[33mNextFunction[39m) [33m=>[39m {
    [31m[1m>[22m[39m[90m 45 |[39m     console[33m.[39merror(err[33m.[39mstack)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 46 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 47 |[39m         status[33m:[39m [32m'error'[39m[33m,[39m
     [90m 48 |[39m         message[33m:[39m [32m'Internal Server Error'[39m[33m,[39m[0m

      at src/index.ts:45:13
      at Layer.handle_error (node_modules/express/lib/router/layer.js:71:5)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (node_modules/express/lib/router/layer.js:67:12)
      at trim_prefix (node_modules/express/lib/router/index.js:326:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at next (node_modules/express/lib/router/route.js:141:14)
      at AuthController.login (src/modules/auth/controllers/auth.controller.ts:45:13)

  console.log
    Executed (default): SELECT "User"."id", "User"."nama", "User"."nik", "User"."password", "User"."employee_id", "User"."role_id", "User"."is_active", "User"."last_login", "User"."created_at", "User"."updated_at", "employee"."id" AS "employee.id", "employee"."foto_karyawan" AS "employee.foto_karyawan", "employee"."nama_lengkap" AS "employee.nama_lengkap", "employee"."nomor_induk_karyawan" AS "employee.nomor_induk_karyawan", "employee"."divisi_id" AS "employee.divisi_id", "employee"."department_id" AS "employee.department_id", "employee"."manager_id" AS "employee.manager_id", "employee"."atasan_langsung_id" AS "employee.atasan_langsung_id", "employee"."posisi_jabatan_id" AS "employee.posisi_jabatan_id", "employee"."email_perusahaan" AS "employee.email_perusahaan", "employee"."nomor_handphone" AS "employee.nomor_handphone", "employee"."status_karyawan_id" AS "employee.status_karyawan_id", "employee"."lokasi_kerja_id" AS "employee.lokasi_kerja_id", "employee"."tag_id" AS "employee.tag_id", "employee"."createdAt" AS "employee.createdAt", "employee"."updatedAt" AS "employee.updatedAt", "roleDetails"."id" AS "roleDetails.id", "roleDetails"."name" AS "roleDetails.name", "roleDetails"."display_name" AS "roleDetails.display_name", "roleDetails"."description" AS "roleDetails.description", "roleDetails"."is_system_role" AS "roleDetails.is_system_role", "roleDetails"."created_at" AS "roleDetails.created_at", "roleDetails"."updated_at" AS "roleDetails.updated_at" FROM "users" AS "User" LEFT OUTER JOIN "employees" AS "employee" ON "User"."employee_id" = "employee"."id" LEFT OUTER JOIN "roles" AS "roleDetails" ON "User"."role_id" = "roleDetails"."id" WHERE "User"."nik" = '999999'; Elapsed time: 1ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executed (default): SELECT "User"."id", "User"."nama", "User"."nik", "User"."password", "User"."employee_id", "User"."role_id", "User"."is_active", "User"."last_login", "User"."created_at", "User"."updated_at", "employee"."id" AS "employee.id", "employee"."foto_karyawan" AS "employee.foto_karyawan", "employee"."nama_lengkap" AS "employee.nama_lengkap", "employee"."nomor_induk_karyawan" AS "employee.nomor_induk_karyawan", "employee"."divisi_id" AS "employee.divisi_id", "employee"."department_id" AS "employee.department_id", "employee"."manager_id" AS "employee.manager_id", "employee"."atasan_langsung_id" AS "employee.atasan_langsung_id", "employee"."posisi_jabatan_id" AS "employee.posisi_jabatan_id", "employee"."email_perusahaan" AS "employee.email_perusahaan", "employee"."nomor_handphone" AS "employee.nomor_handphone", "employee"."status_karyawan_id" AS "employee.status_karyawan_id", "employee"."lokasi_kerja_id" AS "employee.lokasi_kerja_id", "employee"."tag_id" AS "employee.tag_id", "employee"."createdAt" AS "employee.createdAt", "employee"."updatedAt" AS "employee.updatedAt", "roleDetails"."id" AS "roleDetails.id", "roleDetails"."name" AS "roleDetails.name", "roleDetails"."display_name" AS "roleDetails.display_name", "roleDetails"."description" AS "roleDetails.description", "roleDetails"."is_system_role" AS "roleDetails.is_system_role", "roleDetails"."created_at" AS "roleDetails.created_at", "roleDetails"."updated_at" AS "roleDetails.updated_at" FROM "users" AS "User" LEFT OUTER JOIN "employees" AS "employee" ON "User"."employee_id" = "employee"."id" LEFT OUTER JOIN "roles" AS "roleDetails" ON "User"."role_id" = "roleDetails"."id" WHERE "User"."nik" = '000000'; Elapsed time: 1ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

  console.log
    Executed (default): DELETE FROM "users" WHERE "id" = 3 Elapsed time: 4ms

      at Sequelize.log (node_modules/sequelize/src/sequelize.js:1281:15)

FAIL src/modules/auth/__tests__/integration/auth.api.test.ts (16.596 s)
  Auth API Integration
    POST /api/auth/login
      Ã— should login successfully with valid credentials (239 ms)
      âˆš should reject login with invalid password (129 ms)
      âˆš should reject login with non-existent user (9 ms)
      âˆš should reject invalid input format (4 ms)

  â— Auth API Integration â€º POST /api/auth/login â€º should login successfully with valid credentials

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 52 |[39m                 })[33m;[39m
     [90m 53 |[39m
    [31m[1m>[22m[39m[90m 54 |[39m             expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 55 |[39m             expect(res[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'token'[39m)[33m;[39m
     [90m 56 |[39m             expect(res[33m.[39mbody[33m.[39mdata[33m.[39muser)[33m.[39mtoHaveProperty([32m'nik'[39m[33m,[39m testUser[33m.[39mnik)[33m;[39m
     [90m 57 |[39m         })[33m;[39m[0m

      at Object.<anonymous> (src/modules/auth/__tests__/integration/auth.api.test.ts:54:32)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 3 passed, 4 total
Snapshots:   0 total
Time:        17.127 s
Ran all test suites matching /src\\modules\\auth\\__tests__\\integration\\auth.api.test.ts/i.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
